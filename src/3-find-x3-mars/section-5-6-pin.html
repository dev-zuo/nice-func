<!-- 最后一个场景不使用 clip-path 来切换场景，使用 height -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>find-x3-section-5-6</title>
    <script src="/lib/lodash.min.js"></script>
    <script src="/lib/gsap.min.js"></script>
    <script src="/lib/ScrollTrigger.min.js"></script>
    <link rel="stylesheet" href="./fonts/fonts-cn.css" />
    <style>
      body {
        margin: 0;
        height: 7000px;
        background: #0e0e0e;
        color: white;
        overflow-x: hidden;
      }
      .bg {
        z-index: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transform: scale(1.2);
      }
      .section-5 img {
        position: absolute;
      }
      .section-5 {
        position: relative;
        width: 100%;
        min-width: 1000px;
        height: 800px;
      }
      .section-5.active .wrap-main {
        transform: translate(-50%, -50%);
      }
      .wrap-main {
        top: 50%;
        left: 50%;
        transform: translate(-50%, -40%);
        height: 600px;
        width: 950px;
        position: absolute;
        transition: all 1s;
      }
      .wrap-main img {
        position: absolute;
        height: 263px;
      }
      .wrap-main img:nth-child(1) {
        top: 0;
        left: 21px;
        z-index: 4;
      }
      .wrap-main img:nth-child(2) {
        top: 70px;
        left: 140px;
        z-index: 3;
      }
      .wrap-main img:nth-child(3) {
        top: 189px;
        left: 336px;
        z-index: 2;
      }
      .wrap-main img:nth-child(4) {
        top: 350px;
        left: 595px;
        z-index: 1;
      }
    </style>
  </head>
  <body>
    <!-- <p style="padding: 0 40px 85px 10px">Part5: 包装</p> -->
    <section class="section-5">
      <img class="bg" src="./assets/section-5-bg.jpg" />
      <div class="wrap-main">
        <img src="./assets/section-5-1.png" />
        <img src="./assets/section-5-2.png" />
        <img src="./assets/section-5-3.png" />
        <img src="./assets/section-5-4.png" />
      </div>
    </section>
    <!-- Part6 - 第一个场景 -->
    <style>
      #section-6-1 {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 90px;
        text-align: center;
      }
      .comp-inner .title {
        font-size: 35px;
        line-height: 46px;
      }
      .comp-inner .detail {
        margin: 25px auto 0;
        font-size: 15px;
        line-height: 23px;
      }
      #section-6-1 .phone {
        margin: 80px auto 0;
        width: 380px;
        height: 380px;
      }
      .section-6-2-bg {
        width: 100%;
        height: 100vh;
        object-fit: cover;
      }
    </style>
    <section id="section-6-1" style="margin-top: 80px">
      <div class="g--container">
        <div class="comp-inner">
          <div class="title comp-angle-block-fade-in fade-in">
            全面了解色彩影像旗舰
          </div>
          <div class="detail comp-angle-block-fade-in fade-in">
            从捕捉、储存到显示全程 10
            亿色²，隔着屏幕都能感受照片里的喜怒哀乐。<br
              class="g--pt-hidden"
            />色彩唤醒感动，满满创新，等你慢慢揭开。
          </div>
        </div>
        <div class="buttons fade-in" style="margin: 50px auto 0">
          <div class="comp-angle-block small">
            <div class="comp-inner">探索更多 Find X3 系列</div>
          </div>
        </div>
        <img class="phone loaded fade-in" src="./assets/section-6-phone.png" />
      </div>
    </section>
    <!-- Part6: 第二个场景 -->
    <section
      class="section-6-2"
      style="
        position: relative;
        margin-top: -620px;
        height: 100vh;
        min-height: 500px;
      "
    >
      <!-- 背景遮罩上一层，图片，先隐藏，等 1 结束后，再显示  -->
      <div
        class="section-6-2-main"
        style="opacity: 0; z-index: 2; position: relative"
      >
        <!-- 文本区域-->
        <div
          class="comp-border-text text-block"
          style="
            position: absolute;
            text-align: center;
            z-index: 3;
            opacity: 1;
            left: 50%;
            top: 50%;
            transform: translateX(-50%) translateY(-50%);
          "
        >
          <div class="comp-angle-block inner">
            <div class="comp-inner">
              <div class="title comp-angle-block-fade-in">10 亿色，</div>
              <div class="title comp-angle-block-fade-in">
                打开手机色彩新世界
              </div>
              <div class="detail comp-angle-block-fade-in" style="width: 480px">
                搭载全链路 10bit 色彩引擎，重写手机与色彩的定义。<br
                  class="g--pt-hidden"
                />影像可捕捉前所未有的丰富细节、存储忠实无损，屏幕呈现细腻惊艳。10
                亿色彩在每个环节澎湃奔涌，如此绚丽利器，静候你解锁。
              </div>
            </div>
          </div>
        </div>
        <!-- <div class="mask" style="opacity: 1"></div> -->
        <img class="section-6-2-bg" src="./assets/section-6-2.jpg" />
      </div>
      <!-- 背景遮罩 -->
      <div
        class="bg-mask"
        style="
          opacity: 0;
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: #000;
          z-index: 1;
        "
      ></div>
    </section>

    <section class="section-6-3" style="text-align: center">
      <div class="comp-inner" style="padding: 150px 0">
        <div class="title">旗舰四摄，致敬探索，记录此刻</div>
        <div class="detail">
          两颗 10 亿色 5000 万像素旗舰主摄，场面再大，画面也出色。<br />
          60 倍显微镜，带你探索微观世界里的奇观。1300
          万像素长焦，轻松拉近远方美好。
        </div>
      </div>
      <style>
        .section-63-a,
        .section-63-b {
          position: absolute;
          /* top: 0; */
          /* bottom: 0; */
          width: 100%;
          display: flex;
          justify-content: space-between;
          /* height: 100vh;
          min-height: 800px; */
          bottom: 0;
          overflow: hidden;
        }
        .section-63-a {
            top: 0;
            /* height: 100vh;
            min-height: 800px; */
        }
        .section-63-b {
          z-index: 10;
        }
        .sec-circle {
          position: absolute;
          z-index: 1;
          right: 489px;
          top: 106px;
          width: 216px;
          transition: all 1s;
        }
        .s63-a-sec2 .sec-circle {
          right: 686px;
          top: 249px;
          transform: scale(0.92);
        }
        .s63-a-sec.s63-a-sec2.active .sec-circle {
          right: 686px;
          top: 249px;
          transform: scale(0.92) rotate(180deg);
        }
        /* 加上 active 后，圆圈旋转 180° */
        .s63-a-sec.active .sec-circle {
          transform: rotate(180deg);
        }
        .sec-bg {
          width: 999px;
          height: 888px;
          object-fit: cover;
        }
        .sec-circle-scale .line {
          position: absolute;
          height: 1px;
          width: 7px;
          top: 213px;
          right: 590px;
          background: #fff;
          transform-origin: 102px 0;
        }
        .s63-a-sec2 .sec-circle-scale .line {
          top: 358px;
          right: 779px;
          transform-origin: 94px 0;
        }
        .sec-line {
          width: 533px;
          height: 1px;
          background: rgba(255, 255, 255, 0.5);
          -webkit-transform-origin: 100% 0;
          transform-origin: 100% 0;
          position: absolute;
          right: -367px;
          top: 110px;
        }
        .s63-a-sec2 .sec-line {
          width: 315px;
          right: -184px;
        }
        .text-view {
          position: absolute;
          right: 1074px;
          top: 106px;
        }
        /* 文字利用 clip path 隐藏*/
        .text-view p {
          clip-path: inset(0 100% 0 0);
          transition: clip-path 0.7s; /* 0.7 秒完成 */
        }
        .text-view p:nth-child(2) {
          transition: clip-path 1.5s;
        }
        .text-view p:nth-child(3) {
          transition: clip-path 2s;
        }
        /* active 后，文字显示，*/
        .s63-a-sec.active .text-view p {
          clip-path: inset(0 0 0 0);
        }
        .s63-a-sec2 .text-view {
          right: 1075px;
          top: 231px;
        }
        .text-view p {
          text-align: left;
        }
        .s63-a-btns {
          position: absolute;
          right: 1200px;
          font-size: 20px;
        }
        .s63-a-btns div {
          padding: 10px 20px;
          margin-bottom: 10px;
          cursor: pointer;
        }
        .s63-a-btns div.active {
          border: 1px solid #666;
          border-radius: 5px;
        }
        .section-63 {
          position: relative;
          height: 100vh;
          min-height: 800px;
        }
        .section-63-b {
          /* --clip: 100%; */
          transform: scale(1.15);
          /* clip-path: inset(var(--clip) 0 0); */
          --gsapHeight: 0;
          height: var(--gsapHeight);
        }
        .section-63-b .sec-bg {
          width: 100%;
          height: 100%;
        }
        .section-63-b .text-view {
          right: 900px;
          top: 220px;
        }
        .section-63-b .text-view .title {
          font-size: 35px;
          line-height: 54px;
          text-align: left;
        }
        .section-63-b .text-view .name {
          font-size: 25px;
          line-height: 36px;
        }
        .section-63-b .text-view .info {
          font-size: 13px;
          color: rgba(255, 255, 255, 0.7);
        }
        .text-view .spots {
          display: flex;
          flex-wrap: wrap;
          width: 357px;
          padding-top: 30px;
        }
        .text-view .spots .item {
          text-align: left;
          width: 49%;
          margin-top: 25px;
        }
        .section-63-b .text-view > div {
          clip-path: inset(0 50% 0 50%);
          transition: clip-path 0.7s;
        }
        .section-63-b .text-view.active > div {
          clip-path: inset(0 0 0 0);
        }
      </style>
      <div class="section-63">
        <div class="section-63-a">
          <div class="s63-a-btns">
            <div class="active">超广角</div>
            <div>显微镜</div>
          </div>
          <div class="s63-a-sec s63-a-sec1">
            <div class="text-view">
              <p
                style="font-size: 36px; line-height: 52px; padding-bottom: 20px"
              >
                超广角
              </p>
              <div class="sec-line"></div>
              <div>
                <p>5000 万像素超广角</p>
                <p>Sony IMX766 传感器</p>
                <p>1/1.56" 感光面积</p>
              </div>
            </div>
            <div class="sec-circle-scale"></div>
            <img
              class="sec-circle"
              src="./assets/section-6-3-1-camera-circle-outer.svg"
            />
          </div>
          <div class="s63-a-sec s63-a-sec2" style="opacity: 0">
            <div class="text-view">
              <p
                style="font-size: 36px; line-height: 52px; padding-bottom: 20px"
              >
                显微镜
              </p>
              <div class="sec-line"></div>
              <div>
                <p>300 万像素显微镜</p>
                <p>f/3.0 光圈</p>
                <p>
                  60 倍放大<sup>3<sup></sup></sup>
                </p>
              </div>
            </div>
            <div class="sec-circle-scale"></div>
            <img
              class="sec-circle"
              src="./assets/section-6-3-1-camera-circle-outer.svg"
            />
          </div>
          <img class="sec-bg" src="./assets/section6-3-1-camera.png" />
        </div>
        <div class="section-63-b">
          <div class="text-view">
            <div class="title comp-angle-block-fade-in-left fade-in">
              10 亿色臻彩屏，
            </div>
            <div class="title comp-angle-block-fade-in-left fade-in">
              震撼色彩，流畅奔涌
            </div>
            <div class="spots">
              <div class="item">
                <div class="name">10.7 亿色</div>
                <div class="info">色彩显示</div>
              </div>
              <div class="item">
                <div class="name">120Hz</div>
                <div class="info">智能动态帧率<sup>4</sup></div>
              </div>
              <div class="item">
                <div class="name">O1</div>
                <div class="info">超感画质引擎<sup>5</sup></div>
              </div>
              <div class="item">
                <div class="name">O-Sync</div>
                <div class="info">超频响应<sup>6</sup></div>
              </div>
            </div>
          </div>
          <img class="sec-bg" src="./assets/section6-3-2-hvga.png" />
        </div>
        <div class="section-63-c"></div>
        <div class="section-63-d"></div>
      </div>
    </section>
    <script>
      const bgEl = document.querySelector(".bg");
      const img1 = document.querySelector(".wrap-main img:nth-child(1)");
      const img2 = document.querySelector(".wrap-main img:nth-child(2)");
      const img3 = document.querySelector(".wrap-main img:nth-child(3)");
      const img4 = document.querySelector(".wrap-main img:nth-child(4)");
      window.addEventListener("mousemove", (e) => {
        // 鼠标相对页面的位置
        let x = e.pageX;
        let y = e.pageY;
        // section-2 容器相对视口位置
        let parentX = bgEl.offsetLeft;
        let parentY = bgEl.offsetTop;
        let isYOut = y < parentY || y > parentY + bgEl.clientHeight;
        let isXOut = x < parentX || x > parentX + bgEl.clientWidth;
        if (isXOut || isYOut) {
          // console.log("移出去了");
          return;
        }
        console.log(x - parentX, y - parentY);
        // 鼠标从左到右 x 偏移 20px => -20px，鼠标位置(x) 0 => 视口宽度(w)，得出公式：20 - (40*(x/w))
        // 鼠标从上到下 y 偏移 2px => -2px, 鼠标位置(y) 0 => 视口高度(h)，得出公式：2 - (4*(y/h))
        let mouseX = x - parentX;
        let mouseY = y - parentY;
        img1.style.transform = `translate(${
          20 - 40 * (mouseX / screen.width)
        }px,${4 - 8 * (mouseY / screen.height)}px)`;
        img2.style.transform = `translate(${
          28 - 56 * (mouseX / screen.width)
        }px,${6 - 12 * (mouseY / screen.height)}px)`;
        img3.style.transform = `translateX(${
          30 - 60 * (mouseX / screen.width)
        }px`;
        // 鼠标从左到右， -14px => 14px，鼠标位置(x) 0 => 视口宽度(w)，-14 + (28*(x/w))
        // 鼠标从上到下 y 偏移 -2px => 2px, 鼠标位置(y) 0 => 视口高度(h)，得出公式：-2 + (4*(y/h))
        img4.style.transform = `translate(${
          -30 + 60 * (mouseX / screen.width)
        }px,${-6 + 12 * (mouseY / screen.height)}px)`;
        bgEl.style.transform = `scale(1.2) translate(${
          -8 + 16 * (mouseX / screen.width)
        }px,${-2 + 4 * (mouseY / screen.height)}px)`;
      });
      gsap.registerPlugin(ScrollTrigger);
      gsap.to(".section-5", {
        opacity: 1,
        scrollTrigger: {
          trigger: ".section-5",
          toggleClass: "active", // 滚动时上下动画
          end: "+30",
          scrub: true, // 表示动画可以重复执行改成false表示只执行一次
          // markers: true, // 绘制开始位置和结束位置的线条
          // pin: false, // 动画执行期间，页面不进行滚动，动画执行结束后
        },
      });

      // 时间轴测试
      //   let tl = gsap.timeline({
      //     scrollTrigger: {
      //       trigger: ".section-6-2",
      //       start: "top 200px",
      //       end: "+150",
      //       scrub: true,
      //       markers: true,
      //     },
      //   });
      //   tl.to(".bg-mask", { opacity: 1 });
      //   tl.to(".section-6-2-main", { opacity: 1 }); // scrollTrigger 已指定，怎么让这个动画修改对象的属性
      // section-6 第二个盖住第三个，核心是，第二个 margin-top: -100vh;
      // fix 在 .gb-mask 结束遮罩 onLeave 钩子中 gsap.to 使用 pin 时，动画回放后再次执行 pin 位置异常问题
      // 参考：https://codepen.io/GreenSock/pen/YzXdbQo
      ScrollTrigger.create({
        trigger: ".section-6-2",
        start: "top top",
        end: "bottom top", // 200px past the start
        pin: ".section-6-2",
      });
      gsap.to(".bg-mask", {
        opacity: 1,
        scrollTrigger: {
          trigger: ".section-6-2",
          start: "top 200px",
          end: "+200",
          scrub: true, // 表示动画可以重复执行改成false表示只执行一次
          //   markers: true, // 绘制开始位置和结束位置的线条
          onEnterBack() {},
          onLeave() {
            gsap.to(".section-6-2-main", {
              opacity: 1,
              scrollTrigger: {
                trigger: ".section-6-2",
                start: "top top",
                scrub: true, // 表示动画可以重复执行改成false表示只执行一次
                // markers: true, // 绘制开始位置和结束位置的线条
                // pin: true,
              },
            });
          },
        },
      });

      // 生成摄像头周围刻度 dom
      // type 第几个摄像头，默认为 1
      const generateLineDom = (type = "1") => {
        let len = 240;
        let fragment = document.createDocumentFragment();
        for (let i = 0; i < len; i++) {
          let el = document.createElement("div");
          //   console.log("el", el, el.classList);
          el.classList.add(`id-${i}`);
          el.classList.add(`line`);
          // 0 => 239
          // 1.5deg  => 360deg
          // -102
          el.style.transform = `translateX(-102px) rotate(${(i + 1) * 1.5}deg)`;
          fragment.appendChild(el);
        }
        let parentEl = document.querySelector(
          `.s63-a-sec${type} .sec-circle-scale`
        );
        parentEl.append(fragment);
      };
      gsap.to(".section-6-3", {
        opacity: 1,
        scrollTrigger: {
          trigger: ".section-6-3",
          start: "top 100px",
          end: "+800",
          //   markers: true,
          scrub: true,
          toggleClass: {
            targets: ".s63-a-sec1",
            className: "active",
          },
          onEnter() {
            console.log("onEnter");
            generateLineDom(); // 第一个摄像头刻度
            generateLineDom("2"); // 第2个摄像头刻度
          },
        },
      });

      const cameraABtn = document.querySelector(".s63-a-btns div:nth-child(1)");
      const cameraBBtn = document.querySelector(".s63-a-btns div:nth-child(2)");
      cameraABtn.addEventListener("click", (e) => {
        // 切换 active
        document
          .querySelectorAll(".s63-a-btns div")
          .forEach((item) => item.classList.remove("active"));
        e.target.classList.toggle("active");
        // 切换文案区域
        document.querySelector(".s63-a-sec1").style.opacity = "1";
        document.querySelector(".s63-a-sec1").classList.add("active");
        document.querySelector(".s63-a-sec2").style.opacity = "0";
        document.querySelector(".s63-a-sec2").classList.remove("active");
      });
      cameraBBtn.addEventListener("click", (e) => {
        // 切换 active
        document
          .querySelectorAll(".s63-a-btns div")
          .forEach((item) => item.classList.remove("active"));
        e.target.classList.toggle("active");
        // 切换文案区域
        document.querySelector(".s63-a-sec1").style.opacity = "0";
        document.querySelector(".s63-a-sec1").classList.remove("active");
        document.querySelector(".s63-a-sec2").style.opacity = "1";
        document.querySelector(".s63-a-sec2").classList.add("active");
      });

      /* 场景切换 gsap 固定页面 + clip-path */
      gsap.to(".section-63-b", {
        // duration: 10,
        // gsap.to 设置 clip-path 属性变更
        // https://greensock.com/forums/topic/32322-clip-path-to-gsap-animation/
        // 变更 css 变量
        // "--clip": "0", //clip-path(100% 0 0) => clip-path(0 0 0)
        "--gsapHeight": '100%',
        scale: 1,
        scrollTrigger: {
          trigger: ".section-63",
          start: "top top",
          end: "+800",
          //   markers: true,
          scrub: true,
          pin: true,
          onEnterBack() {
            document
              .querySelector(".section-63-b .text-view")
              .classList.remove("active");
          },
          onLeave() {
            document
              .querySelector(".section-63-b .text-view")
              .classList.add("active");
          },
        },
      });

    //   gsap.to(".section-63", {
    //     opacity: 1,
    //     scrollTrigger: {
    //       trigger: ".section-63-b",
    //       start: "top top",
    //       end: "+800",
    //       //   markers: true,
    //       scrub: true,
    //       pin: true,
    //     },
    //   });
      ScrollTrigger.create({
        trigger: ".section-63-b",
        start: "top top",
        end: "+800px", // 200px past the start
        markers: true,
        pin: ".section-63",
      });
    </script>
  </body>
</html>
